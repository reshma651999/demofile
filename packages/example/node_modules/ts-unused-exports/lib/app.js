"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var ts = require("typescript");
var analyzer_1 = require("./analyzer");
var path_1 = require("path");
var argsParser_1 = require("./argsParser");
var parser_1 = require("./parser");
var fs_1 = require("fs");
var parseTsConfig = function (tsconfigPath) {
    var _a, _b, _c, _d;
    var basePath = path_1.resolve(path_1.dirname(tsconfigPath));
    try {
        var parseJsonResult = ts.parseConfigFileTextToJson(tsconfigPath, fs_1.readFileSync(tsconfigPath, { encoding: 'utf8' }));
        if (parseJsonResult.error)
            throw parseJsonResult.error;
        var result = ts.parseJsonConfigFileContent(parseJsonResult.config, ts.sys, basePath);
        if (result.errors.length)
            throw result.errors;
        return {
            baseUrl: ((_b = (_a = result.raw) === null || _a === void 0 ? void 0 : _a.compilerOptions) === null || _b === void 0 ? void 0 : _b.baseUrl) || '.',
            paths: (_d = (_c = result.raw) === null || _c === void 0 ? void 0 : _c.compilerOptions) === null || _d === void 0 ? void 0 : _d.paths,
            files: result.fileNames,
        };
    }
    catch (e) {
        throw "\n    Cannot parse '" + tsconfigPath + "'.\n\n    " + JSON.stringify(e) + "\n  ";
    }
};
var loadTsConfig = function (tsconfigPath, explicitFiles) {
    var _a = parseTsConfig(tsconfigPath), baseUrl = _a.baseUrl, files = _a.files, paths = _a.paths;
    return { baseUrl: baseUrl, paths: paths, files: explicitFiles || files };
};
exports.default = (function (tsconfigPath, files) {
    var args = argsParser_1.extractOptionsFromFiles(files);
    var tsConfig = loadTsConfig(tsconfigPath, args.tsFiles);
    return analyzer_1.default(parser_1.default(path_1.dirname(tsconfigPath), tsConfig, args.options), args.options);
});
//# sourceMappingURL=app.js.map